<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="styles/style-novaconversa.css">
    <script src="https://kit.fontawesome.com/b8475028b4.js" crossorigin="anonymous"></script>
    <title> Nova conversa </title>
</head>
<body>
    <header>
        <h2 class="title title-principal"> Nova Conversa </h2>
        <a onclick="showSidebar()" href="#"> <i class="fa-solid fa-bars icon-sidebar" style="color: #63E6BE;"></i> </a>
    </header>

    <nav>
        <ul class="sidebar">
            <li onclick="hideSidebar()"><a href="#"> <i class="fa-solid fa-bars icon-sidebar" style="color: #63E6BE;" size="200px"></i> </a></li>
            <li> <button id="btn-telainicial" class="hideOnMobile"> <i class="fa-solid fa-house"> </i> Tela Inicial</button> </li> 
            <li> <button id="btn-configuracoes" class="hideOnMobile"> Configurações </button></li>
            <li> <button id="btn-sair-conta" class="hideOnMobile"> Sair </button> </li>
        </ul>  
    </nav>

    <script>
        function showSidebar() {
            const sidebar = document.querySelector('.sidebar')
            sidebar.style.display = 'flex'
        }

        function hideSidebar() {
            const sidebar = document.querySelector('.sidebar')
            sidebar.style.display = 'none'
        }
    </script>
    
    <div class="container-total">
        <div class="container-inicial"> 
            <div class="content-txt">
                <h2 class="title title-txt"> Carregar .TXT </h2>
                <p class="description description-txt"> Insira seu arquivo .txt e carregue seus dados, para criar um chat. </p>

                <!-- FORMULÁRIO DE UPLOAD -->
                <form id="uploadForm" enctype="multipart/form-data">
                    <label class="div-input" for="myFiles">
                        <i class="fa-solid fa-file icon-modify" style="color: #63E6BE;"></i>
                        <input type="file" id="myFiles" accept=".txt" multiple />
                    </label> 
                    <button type="submit"> Upload File </button>
                </form>

                <h5></h5>
                <h6></h6>

                <script>
                    const form = document.getElementById('uploadForm');

                    const sendFiles = async () => {
                        const myFiles = document.getElementById('myFiles').files;
                        const formData = new FormData();

                        Object.keys(myFiles).forEach(key => {
                            const file = myFiles.item(key);
                            formData.append(file.name, file);

                            // Salva o nome do primeiro arquivo
                            if (key == 0) {
                                localStorage.setItem("arquivo", file.name);
                            }
                        });

                        const response = await fetch('http://127.0.0.1:3000/upload', {
                            method: 'POST',
                            body: formData
                        });

                        const json = await response.json();

                        const h5 = document.querySelector('h5');
                        h5.textContent = `Status: ${json?.status}`;

                        const h6 = document.querySelector('h6');
                        h6.textContent = json?.message;

                        console.log(json);

                        // Redireciona automaticamente para o chat após sucesso
                        if (json?.status === "success") {
                            window.location.href = "conversa_chatbot.html";
                        }
                    };

                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        sendFiles();
                    });
                    
                </script>
            </div>
        </div>
    </div>

    <script src="js/barraopcoes.js"></script>

</body>
</html>